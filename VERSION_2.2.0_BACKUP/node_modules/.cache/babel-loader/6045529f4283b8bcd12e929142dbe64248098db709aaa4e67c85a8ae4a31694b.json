{"ast":null,"code":"/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\nimport { __awaiter } from \"tslib\";\n/**\n * @module BatchRequestContent\n */\nimport { RequestMethod } from \"../RequestMethod\";\n/**\n * @class\n * Class for handling BatchRequestContent\n */\nexport class BatchRequestContent {\n  /**\n   * @private\n   * @static\n   * Validates the dependency chain of the requests\n   *\n   * Note:\n   * Individual requests can depend on other individual requests. Currently, requests can only depend on a single other request, and must follow one of these three patterns:\n   * 1. Parallel - no individual request states a dependency in the dependsOn property.\n   * 2. Serial - all individual requests depend on the previous individual request.\n   * 3. Same - all individual requests that state a dependency in the dependsOn property, state the same dependency.\n   * As JSON batching matures, these limitations will be removed.\n   * @see {@link https://developer.microsoft.com/en-us/graph/docs/concepts/known_issues#json-batching}\n   *\n   * @param {Map<string, BatchRequestStep>} requests - The map of requests.\n   * @returns The boolean indicating the validation status\n   */\n  static validateDependencies(requests) {\n    const isParallel = reqs => {\n      const iterator = reqs.entries();\n      let cur = iterator.next();\n      while (!cur.done) {\n        const curReq = cur.value[1];\n        if (curReq.dependsOn !== undefined && curReq.dependsOn.length > 0) {\n          return false;\n        }\n        cur = iterator.next();\n      }\n      return true;\n    };\n    const isSerial = reqs => {\n      const iterator = reqs.entries();\n      let cur = iterator.next();\n      const firstRequest = cur.value[1];\n      if (firstRequest.dependsOn !== undefined && firstRequest.dependsOn.length > 0) {\n        return false;\n      }\n      let prev = cur;\n      cur = iterator.next();\n      while (!cur.done) {\n        const curReq = cur.value[1];\n        if (curReq.dependsOn === undefined || curReq.dependsOn.length !== 1 || curReq.dependsOn[0] !== prev.value[1].id) {\n          return false;\n        }\n        prev = cur;\n        cur = iterator.next();\n      }\n      return true;\n    };\n    const isSame = reqs => {\n      const iterator = reqs.entries();\n      let cur = iterator.next();\n      const firstRequest = cur.value[1];\n      let dependencyId;\n      if (firstRequest.dependsOn === undefined || firstRequest.dependsOn.length === 0) {\n        dependencyId = firstRequest.id;\n      } else {\n        if (firstRequest.dependsOn.length === 1) {\n          const fDependencyId = firstRequest.dependsOn[0];\n          if (fDependencyId !== firstRequest.id && reqs.has(fDependencyId)) {\n            dependencyId = fDependencyId;\n          } else {\n            return false;\n          }\n        } else {\n          return false;\n        }\n      }\n      cur = iterator.next();\n      while (!cur.done) {\n        const curReq = cur.value[1];\n        if ((curReq.dependsOn === undefined || curReq.dependsOn.length === 0) && dependencyId !== curReq.id) {\n          return false;\n        }\n        if (curReq.dependsOn !== undefined && curReq.dependsOn.length !== 0) {\n          if (curReq.dependsOn.length === 1 && (curReq.id === dependencyId || curReq.dependsOn[0] !== dependencyId)) {\n            return false;\n          }\n          if (curReq.dependsOn.length > 1) {\n            return false;\n          }\n        }\n        cur = iterator.next();\n      }\n      return true;\n    };\n    if (requests.size === 0) {\n      const error = new Error(\"Empty requests map, Please provide at least one request.\");\n      error.name = \"Empty Requests Error\";\n      throw error;\n    }\n    return isParallel(requests) || isSerial(requests) || isSame(requests);\n  }\n  /**\n   * @private\n   * @static\n   * @async\n   * Converts Request Object instance to a JSON\n   * @param {IsomorphicRequest} request - The IsomorphicRequest Object instance\n   * @returns A promise that resolves to JSON representation of a request\n   */\n  static getRequestData(request) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const requestData = {\n        url: \"\"\n      };\n      const hasHttpRegex = new RegExp(\"^https?://\");\n      // Stripping off hostname, port and url scheme\n      requestData.url = hasHttpRegex.test(request.url) ? \"/\" + request.url.split(/.*?\\/\\/.*?\\//)[1] : request.url;\n      requestData.method = request.method;\n      const headers = {};\n      request.headers.forEach((value, key) => {\n        headers[key] = value;\n      });\n      if (Object.keys(headers).length) {\n        requestData.headers = headers;\n      }\n      if (request.method === RequestMethod.PATCH || request.method === RequestMethod.POST || request.method === RequestMethod.PUT) {\n        requestData.body = yield BatchRequestContent.getRequestBody(request);\n      }\n      /**\n       * TODO: Check any other property needs to be used from the Request object and add them\n       */\n      return requestData;\n    });\n  }\n  /**\n   * @private\n   * @static\n   * @async\n   * Gets the body of a Request object instance\n   * @param {IsomorphicRequest} request - The IsomorphicRequest object instance\n   * @returns The Promise that resolves to a body value of a Request\n   */\n  static getRequestBody(request) {\n    return __awaiter(this, void 0, void 0, function* () {\n      let bodyParsed = false;\n      let body;\n      try {\n        const cloneReq = request.clone();\n        body = yield cloneReq.json();\n        bodyParsed = true;\n      } catch (e) {\n        //TODO- Handle empty catches\n      }\n      if (!bodyParsed) {\n        try {\n          if (typeof Blob !== \"undefined\") {\n            const blob = yield request.blob();\n            const reader = new FileReader();\n            body = yield new Promise(resolve => {\n              reader.addEventListener(\"load\", () => {\n                const dataURL = reader.result;\n                /**\n                 * Some valid dataURL schemes:\n                 *  1. data:text/vnd-example+xyz;foo=bar;base64,R0lGODdh\n                 *  2. data:text/plain;charset=UTF-8;page=21,the%20data:1234,5678\n                 *  3. data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\n                 *  4. data:image/png,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\n                 *  5. data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\n                 * @see Syntax {@link https://en.wikipedia.org/wiki/Data_URI_scheme} for more\n                 */\n                const regex = new RegExp(\"^s*data:(.+?/.+?(;.+?=.+?)*)?(;base64)?,(.*)s*$\");\n                const segments = regex.exec(dataURL);\n                resolve(segments[4]);\n              }, false);\n              reader.readAsDataURL(blob);\n            });\n          } else if (typeof Buffer !== \"undefined\") {\n            const buffer = yield request.buffer();\n            body = buffer.toString(\"base64\");\n          }\n          bodyParsed = true;\n        } catch (e) {\n          // TODO-Handle empty catches\n        }\n      }\n      return body;\n    });\n  }\n  /**\n   * @public\n   * @constructor\n   * Constructs a BatchRequestContent instance\n   * @param {BatchRequestStep[]} [requests] - Array of requests value\n   * @returns An instance of a BatchRequestContent\n   */\n  constructor(requests) {\n    this.requests = new Map();\n    if (typeof requests !== \"undefined\") {\n      const limit = BatchRequestContent.requestLimit;\n      if (requests.length > limit) {\n        const error = new Error(\"Maximum requests limit exceeded, Max allowed number of requests are \".concat(limit));\n        error.name = \"Limit Exceeded Error\";\n        throw error;\n      }\n      for (const req of requests) {\n        this.addRequest(req);\n      }\n    }\n  }\n  /**\n   * @public\n   * Adds a request to the batch request content\n   * @param {BatchRequestStep} request - The request value\n   * @returns The id of the added request\n   */\n  addRequest(request) {\n    const limit = BatchRequestContent.requestLimit;\n    if (request.id === \"\") {\n      const error = new Error(\"Id for a request is empty, Please provide an unique id\");\n      error.name = \"Empty Id For Request\";\n      throw error;\n    }\n    if (this.requests.size === limit) {\n      const error = new Error(\"Maximum requests limit exceeded, Max allowed number of requests are \".concat(limit));\n      error.name = \"Limit Exceeded Error\";\n      throw error;\n    }\n    if (this.requests.has(request.id)) {\n      const error = new Error(\"Adding request with duplicate id \".concat(request.id, \", Make the id of the requests unique\"));\n      error.name = \"Duplicate RequestId Error\";\n      throw error;\n    }\n    this.requests.set(request.id, request);\n    return request.id;\n  }\n  /**\n   * @public\n   * Removes request from the batch payload and its dependencies from all dependents\n   * @param {string} requestId - The id of a request that needs to be removed\n   * @returns The boolean indicating removed status\n   */\n  removeRequest(requestId) {\n    const deleteStatus = this.requests.delete(requestId);\n    const iterator = this.requests.entries();\n    let cur = iterator.next();\n    /**\n     * Removing dependencies where this request is present as a dependency\n     */\n    while (!cur.done) {\n      const dependencies = cur.value[1].dependsOn;\n      if (typeof dependencies !== \"undefined\") {\n        const index = dependencies.indexOf(requestId);\n        if (index !== -1) {\n          dependencies.splice(index, 1);\n        }\n        if (dependencies.length === 0) {\n          delete cur.value[1].dependsOn;\n        }\n      }\n      cur = iterator.next();\n    }\n    return deleteStatus;\n  }\n  /**\n   * @public\n   * @async\n   * Serialize content from BatchRequestContent instance\n   * @returns The body content to make batch request\n   */\n  getContent() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const requests = [];\n      const requestBody = {\n        requests\n      };\n      const iterator = this.requests.entries();\n      let cur = iterator.next();\n      if (cur.done) {\n        const error = new Error(\"No requests added yet, Please add at least one request.\");\n        error.name = \"Empty Payload\";\n        throw error;\n      }\n      if (!BatchRequestContent.validateDependencies(this.requests)) {\n        const error = new Error(\"Invalid dependency found, Dependency should be:\\n1. Parallel - no individual request states a dependency in the dependsOn property.\\n2. Serial - all individual requests depend on the previous individual request.\\n3. Same - all individual requests that state a dependency in the dependsOn property, state the same dependency.\");\n        error.name = \"Invalid Dependency\";\n        throw error;\n      }\n      while (!cur.done) {\n        const requestStep = cur.value[1];\n        const batchRequestData = yield BatchRequestContent.getRequestData(requestStep.request);\n        /**\n         * @see{@https://tools.ietf.org/html/rfc7578#section-4.4}\n         * TODO- Setting/Defaulting of content-type header to the correct value\n         * @see {@link https://developer.microsoft.com/en-us/graph/docs/concepts/json_batching#request-format}\n         */\n        if (batchRequestData.body !== undefined && (batchRequestData.headers === undefined || batchRequestData.headers[\"content-type\"] === undefined)) {\n          const error = new Error(\"Content-type header is not mentioned for request #\".concat(requestStep.id, \", For request having body, Content-type header should be mentioned\"));\n          error.name = \"Invalid Content-type header\";\n          throw error;\n        }\n        batchRequestData.id = requestStep.id;\n        if (requestStep.dependsOn !== undefined && requestStep.dependsOn.length > 0) {\n          batchRequestData.dependsOn = requestStep.dependsOn;\n        }\n        requests.push(batchRequestData);\n        cur = iterator.next();\n      }\n      requestBody.requests = requests;\n      return requestBody;\n    });\n  }\n  /**\n   * @public\n   * Adds a dependency for a given dependent request\n   * @param {string} dependentId - The id of the dependent request\n   * @param {string} [dependencyId] - The id of the dependency request, if not specified the preceding request will be considered as a dependency\n   * @returns Nothing\n   */\n  addDependency(dependentId, dependencyId) {\n    if (!this.requests.has(dependentId)) {\n      const error = new Error(\"Dependent \".concat(dependentId, \" does not exists, Please check the id\"));\n      error.name = \"Invalid Dependent\";\n      throw error;\n    }\n    if (typeof dependencyId !== \"undefined\" && !this.requests.has(dependencyId)) {\n      const error = new Error(\"Dependency \".concat(dependencyId, \" does not exists, Please check the id\"));\n      error.name = \"Invalid Dependency\";\n      throw error;\n    }\n    if (typeof dependencyId !== \"undefined\") {\n      const dependent = this.requests.get(dependentId);\n      if (dependent.dependsOn === undefined) {\n        dependent.dependsOn = [];\n      }\n      if (dependent.dependsOn.indexOf(dependencyId) !== -1) {\n        const error = new Error(\"Dependency \".concat(dependencyId, \" is already added for the request \").concat(dependentId));\n        error.name = \"Duplicate Dependency\";\n        throw error;\n      }\n      dependent.dependsOn.push(dependencyId);\n    } else {\n      const iterator = this.requests.entries();\n      let prev;\n      let cur = iterator.next();\n      while (!cur.done && cur.value[1].id !== dependentId) {\n        prev = cur;\n        cur = iterator.next();\n      }\n      if (typeof prev !== \"undefined\") {\n        const dId = prev.value[0];\n        if (cur.value[1].dependsOn === undefined) {\n          cur.value[1].dependsOn = [];\n        }\n        if (cur.value[1].dependsOn.indexOf(dId) !== -1) {\n          const error = new Error(\"Dependency \".concat(dId, \" is already added for the request \").concat(dependentId));\n          error.name = \"Duplicate Dependency\";\n          throw error;\n        }\n        cur.value[1].dependsOn.push(dId);\n      } else {\n        const error = new Error(\"Can't add dependency \".concat(dependencyId, \", There is only a dependent request in the batch\"));\n        error.name = \"Invalid Dependency Addition\";\n        throw error;\n      }\n    }\n  }\n  /**\n   * @public\n   * Removes a dependency for a given dependent request id\n   * @param {string} dependentId - The id of the dependent request\n   * @param {string} [dependencyId] - The id of the dependency request, if not specified will remove all the dependencies of that request\n   * @returns The boolean indicating removed status\n   */\n  removeDependency(dependentId, dependencyId) {\n    const request = this.requests.get(dependentId);\n    if (typeof request === \"undefined\" || request.dependsOn === undefined || request.dependsOn.length === 0) {\n      return false;\n    }\n    if (typeof dependencyId !== \"undefined\") {\n      const index = request.dependsOn.indexOf(dependencyId);\n      if (index === -1) {\n        return false;\n      }\n      request.dependsOn.splice(index, 1);\n      return true;\n    } else {\n      delete request.dependsOn;\n      return true;\n    }\n  }\n}\n/**\n * @private\n * @static\n * Limit for number of requests {@link - https://developer.microsoft.com/en-us/graph/docs/concepts/known_issues#json-batching}\n */\nBatchRequestContent.requestLimit = 20;","map":{"version":3,"names":["RequestMethod","BatchRequestContent","validateDependencies","requests","isParallel","reqs","iterator","entries","cur","next","done","curReq","value","dependsOn","undefined","length","isSerial","firstRequest","prev","id","isSame","dependencyId","fDependencyId","has","size","error","Error","name","getRequestData","request","requestData","url","hasHttpRegex","RegExp","test","split","method","headers","forEach","key","Object","keys","PATCH","POST","PUT","body","getRequestBody","bodyParsed","cloneReq","clone","json","e","Blob","blob","reader","FileReader","Promise","resolve","addEventListener","dataURL","result","regex","segments","exec","readAsDataURL","Buffer","buffer","toString","constructor","Map","limit","requestLimit","concat","req","addRequest","set","removeRequest","requestId","deleteStatus","delete","dependencies","index","indexOf","splice","getContent","requestBody","requestStep","batchRequestData","push","addDependency","dependentId","dependent","get","dId","removeDependency"],"sources":["/Users/nic/housing-deadlines-app/node_modules/@microsoft/microsoft-graph-client/src/content/BatchRequestContent.ts"],"sourcesContent":["/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n/**\n * @module BatchRequestContent\n */\nimport { RequestMethod } from \"../RequestMethod\";\n\n/**\n * @interface\n * Signature to represent the buffer request body parsing method\n * @property {Function} buffer - Returns a promise that resolves to a buffer of the request body\n */\ninterface NodeBody {\n\tbuffer(): Promise<Buffer>;\n}\n\n/**\n * @interface\n * Signature to represent the Request for both Node and browser environments\n * @extends Request\n * @extends NodeBody\n */\ninterface IsomorphicRequest extends Request, NodeBody {}\n\n/**\n * @interface\n * Signature representing BatchRequestStep data\n * @property {string} id - Unique identity for the request, Should not be an empty string\n * @property {string[]} [dependsOn] - Array of dependencies\n * @property {Request} request - The Request object\n */\nexport interface BatchRequestStep {\n\tid: string;\n\tdependsOn?: string[];\n\trequest: Request;\n}\n\n/**\n * @interface\n * Signature representing single request in a Batching\n * @extends RequestInit\n * @see {@link https://github.com/Microsoft/TypeScript/blob/master/lib/lib.dom.d.ts#L1337} and {@link https://fetch.spec.whatwg.org/#requestinit}\n *\n * @property {string} url - The url value of the request\n */\n\nexport interface RequestData extends RequestInit {\n\turl: string;\n}\n\n/**\n * @interface\n * Signature representing batch request data\n * @property {string} id - Unique identity for the request, Should not be an empty string\n * @property {string[]} [dependsOn] - Array of dependencies\n */\nexport interface BatchRequestData extends RequestData {\n\tid: string;\n\tdependsOn?: string[];\n}\n\n/**\n * @interface\n * Signature representing batch request body\n * @property {BatchRequestData[]} requests - Array of request data, a json representation of requests for batch\n */\n\nexport interface BatchRequestBody {\n\trequests: BatchRequestData[];\n}\n\n/**\n * @class\n * Class for handling BatchRequestContent\n */\nexport class BatchRequestContent {\n\t/**\n\t * @private\n\t * @static\n\t * Limit for number of requests {@link - https://developer.microsoft.com/en-us/graph/docs/concepts/known_issues#json-batching}\n\t */\n\tprivate static requestLimit = 20;\n\n\t/**\n\t * @public\n\t * To keep track of requests, key will be id of the request and value will be the request json\n\t */\n\tpublic requests: Map<string, BatchRequestStep>;\n\n\t/**\n\t * @private\n\t * @static\n\t * Validates the dependency chain of the requests\n\t *\n\t * Note:\n\t * Individual requests can depend on other individual requests. Currently, requests can only depend on a single other request, and must follow one of these three patterns:\n\t * 1. Parallel - no individual request states a dependency in the dependsOn property.\n\t * 2. Serial - all individual requests depend on the previous individual request.\n\t * 3. Same - all individual requests that state a dependency in the dependsOn property, state the same dependency.\n\t * As JSON batching matures, these limitations will be removed.\n\t * @see {@link https://developer.microsoft.com/en-us/graph/docs/concepts/known_issues#json-batching}\n\t *\n\t * @param {Map<string, BatchRequestStep>} requests - The map of requests.\n\t * @returns The boolean indicating the validation status\n\t */\n\n\tprivate static validateDependencies(requests: Map<string, BatchRequestStep>): boolean {\n\t\tconst isParallel = (reqs: Map<string, BatchRequestStep>): boolean => {\n\t\t\tconst iterator = reqs.entries();\n\t\t\tlet cur = iterator.next();\n\t\t\twhile (!cur.done) {\n\t\t\t\tconst curReq = cur.value[1];\n\t\t\t\tif (curReq.dependsOn !== undefined && curReq.dependsOn.length > 0) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tcur = iterator.next();\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\t\tconst isSerial = (reqs: Map<string, BatchRequestStep>): boolean => {\n\t\t\tconst iterator = reqs.entries();\n\t\t\tlet cur = iterator.next();\n\t\t\tconst firstRequest: BatchRequestStep = cur.value[1];\n\t\t\tif (firstRequest.dependsOn !== undefined && firstRequest.dependsOn.length > 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tlet prev = cur;\n\t\t\tcur = iterator.next();\n\t\t\twhile (!cur.done) {\n\t\t\t\tconst curReq: BatchRequestStep = cur.value[1];\n\t\t\t\tif (curReq.dependsOn === undefined || curReq.dependsOn.length !== 1 || curReq.dependsOn[0] !== prev.value[1].id) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tprev = cur;\n\t\t\t\tcur = iterator.next();\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\t\tconst isSame = (reqs: Map<string, BatchRequestStep>): boolean => {\n\t\t\tconst iterator = reqs.entries();\n\t\t\tlet cur = iterator.next();\n\t\t\tconst firstRequest: BatchRequestStep = cur.value[1];\n\t\t\tlet dependencyId: string;\n\t\t\tif (firstRequest.dependsOn === undefined || firstRequest.dependsOn.length === 0) {\n\t\t\t\tdependencyId = firstRequest.id;\n\t\t\t} else {\n\t\t\t\tif (firstRequest.dependsOn.length === 1) {\n\t\t\t\t\tconst fDependencyId = firstRequest.dependsOn[0];\n\t\t\t\t\tif (fDependencyId !== firstRequest.id && reqs.has(fDependencyId)) {\n\t\t\t\t\t\tdependencyId = fDependencyId;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcur = iterator.next();\n\t\t\twhile (!cur.done) {\n\t\t\t\tconst curReq = cur.value[1];\n\t\t\t\tif ((curReq.dependsOn === undefined || curReq.dependsOn.length === 0) && dependencyId !== curReq.id) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (curReq.dependsOn !== undefined && curReq.dependsOn.length !== 0) {\n\t\t\t\t\tif (curReq.dependsOn.length === 1 && (curReq.id === dependencyId || curReq.dependsOn[0] !== dependencyId)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (curReq.dependsOn.length > 1) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcur = iterator.next();\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\t\tif (requests.size === 0) {\n\t\t\tconst error = new Error(\"Empty requests map, Please provide at least one request.\");\n\t\t\terror.name = \"Empty Requests Error\";\n\t\t\tthrow error;\n\t\t}\n\t\treturn isParallel(requests) || isSerial(requests) || isSame(requests);\n\t}\n\n\t/**\n\t * @private\n\t * @static\n\t * @async\n\t * Converts Request Object instance to a JSON\n\t * @param {IsomorphicRequest} request - The IsomorphicRequest Object instance\n\t * @returns A promise that resolves to JSON representation of a request\n\t */\n\tprivate static async getRequestData(request: IsomorphicRequest): Promise<RequestData> {\n\t\tconst requestData: RequestData = {\n\t\t\turl: \"\",\n\t\t};\n\t\tconst hasHttpRegex = new RegExp(\"^https?://\");\n\t\t// Stripping off hostname, port and url scheme\n\t\trequestData.url = hasHttpRegex.test(request.url) ? \"/\" + request.url.split(/.*?\\/\\/.*?\\//)[1] : request.url;\n\t\trequestData.method = request.method;\n\t\tconst headers = {};\n\t\trequest.headers.forEach((value, key) => {\n\t\t\theaders[key] = value;\n\t\t});\n\t\tif (Object.keys(headers).length) {\n\t\t\trequestData.headers = headers;\n\t\t}\n\t\tif (request.method === RequestMethod.PATCH || request.method === RequestMethod.POST || request.method === RequestMethod.PUT) {\n\t\t\trequestData.body = await BatchRequestContent.getRequestBody(request);\n\t\t}\n\t\t/**\n\t\t * TODO: Check any other property needs to be used from the Request object and add them\n\t\t */\n\t\treturn requestData;\n\t}\n\n\t/**\n\t * @private\n\t * @static\n\t * @async\n\t * Gets the body of a Request object instance\n\t * @param {IsomorphicRequest} request - The IsomorphicRequest object instance\n\t * @returns The Promise that resolves to a body value of a Request\n\t */\n\tprivate static async getRequestBody(request: IsomorphicRequest): Promise<any> {\n\t\tlet bodyParsed = false;\n\t\tlet body;\n\t\ttry {\n\t\t\tconst cloneReq = request.clone();\n\t\t\tbody = await cloneReq.json();\n\t\t\tbodyParsed = true;\n\t\t} catch (e) {\n\t\t\t//TODO- Handle empty catches\n\t\t}\n\t\tif (!bodyParsed) {\n\t\t\ttry {\n\t\t\t\tif (typeof Blob !== \"undefined\") {\n\t\t\t\t\tconst blob = await request.blob();\n\t\t\t\t\tconst reader = new FileReader();\n\t\t\t\t\tbody = await new Promise((resolve) => {\n\t\t\t\t\t\treader.addEventListener(\n\t\t\t\t\t\t\t\"load\",\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tconst dataURL = reader.result as string;\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * Some valid dataURL schemes:\n\t\t\t\t\t\t\t\t *  1. data:text/vnd-example+xyz;foo=bar;base64,R0lGODdh\n\t\t\t\t\t\t\t\t *  2. data:text/plain;charset=UTF-8;page=21,the%20data:1234,5678\n\t\t\t\t\t\t\t\t *  3. data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\n\t\t\t\t\t\t\t\t *  4. data:image/png,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\n\t\t\t\t\t\t\t\t *  5. data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\n\t\t\t\t\t\t\t\t * @see Syntax {@link https://en.wikipedia.org/wiki/Data_URI_scheme} for more\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tconst regex = new RegExp(\"^s*data:(.+?/.+?(;.+?=.+?)*)?(;base64)?,(.*)s*$\");\n\t\t\t\t\t\t\t\tconst segments = regex.exec(dataURL);\n\t\t\t\t\t\t\t\tresolve(segments[4]);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t);\n\t\t\t\t\t\treader.readAsDataURL(blob);\n\t\t\t\t\t});\n\t\t\t\t} else if (typeof Buffer !== \"undefined\") {\n\t\t\t\t\tconst buffer = await request.buffer();\n\t\t\t\t\tbody = buffer.toString(\"base64\");\n\t\t\t\t}\n\t\t\t\tbodyParsed = true;\n\t\t\t} catch (e) {\n\t\t\t\t// TODO-Handle empty catches\n\t\t\t}\n\t\t}\n\t\treturn body;\n\t}\n\n\t/**\n\t * @public\n\t * @constructor\n\t * Constructs a BatchRequestContent instance\n\t * @param {BatchRequestStep[]} [requests] - Array of requests value\n\t * @returns An instance of a BatchRequestContent\n\t */\n\tpublic constructor(requests?: BatchRequestStep[]) {\n\t\tthis.requests = new Map();\n\t\tif (typeof requests !== \"undefined\") {\n\t\t\tconst limit = BatchRequestContent.requestLimit;\n\t\t\tif (requests.length > limit) {\n\t\t\t\tconst error = new Error(`Maximum requests limit exceeded, Max allowed number of requests are ${limit}`);\n\t\t\t\terror.name = \"Limit Exceeded Error\";\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t\tfor (const req of requests) {\n\t\t\t\tthis.addRequest(req);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @public\n\t * Adds a request to the batch request content\n\t * @param {BatchRequestStep} request - The request value\n\t * @returns The id of the added request\n\t */\n\tpublic addRequest(request: BatchRequestStep): string {\n\t\tconst limit = BatchRequestContent.requestLimit;\n\t\tif (request.id === \"\") {\n\t\t\tconst error = new Error(`Id for a request is empty, Please provide an unique id`);\n\t\t\terror.name = \"Empty Id For Request\";\n\t\t\tthrow error;\n\t\t}\n\t\tif (this.requests.size === limit) {\n\t\t\tconst error = new Error(`Maximum requests limit exceeded, Max allowed number of requests are ${limit}`);\n\t\t\terror.name = \"Limit Exceeded Error\";\n\t\t\tthrow error;\n\t\t}\n\t\tif (this.requests.has(request.id)) {\n\t\t\tconst error = new Error(`Adding request with duplicate id ${request.id}, Make the id of the requests unique`);\n\t\t\terror.name = \"Duplicate RequestId Error\";\n\t\t\tthrow error;\n\t\t}\n\t\tthis.requests.set(request.id, request);\n\t\treturn request.id;\n\t}\n\n\t/**\n\t * @public\n\t * Removes request from the batch payload and its dependencies from all dependents\n\t * @param {string} requestId - The id of a request that needs to be removed\n\t * @returns The boolean indicating removed status\n\t */\n\tpublic removeRequest(requestId: string): boolean {\n\t\tconst deleteStatus = this.requests.delete(requestId);\n\t\tconst iterator = this.requests.entries();\n\t\tlet cur = iterator.next();\n\t\t/**\n\t\t * Removing dependencies where this request is present as a dependency\n\t\t */\n\t\twhile (!cur.done) {\n\t\t\tconst dependencies = cur.value[1].dependsOn;\n\t\t\tif (typeof dependencies !== \"undefined\") {\n\t\t\t\tconst index = dependencies.indexOf(requestId);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tdependencies.splice(index, 1);\n\t\t\t\t}\n\t\t\t\tif (dependencies.length === 0) {\n\t\t\t\t\tdelete cur.value[1].dependsOn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcur = iterator.next();\n\t\t}\n\t\treturn deleteStatus;\n\t}\n\n\t/**\n\t * @public\n\t * @async\n\t * Serialize content from BatchRequestContent instance\n\t * @returns The body content to make batch request\n\t */\n\tpublic async getContent(): Promise<BatchRequestBody> {\n\t\tconst requests: BatchRequestData[] = [];\n\t\tconst requestBody: BatchRequestBody = {\n\t\t\trequests,\n\t\t};\n\t\tconst iterator = this.requests.entries();\n\t\tlet cur = iterator.next();\n\t\tif (cur.done) {\n\t\t\tconst error = new Error(\"No requests added yet, Please add at least one request.\");\n\t\t\terror.name = \"Empty Payload\";\n\t\t\tthrow error;\n\t\t}\n\t\tif (!BatchRequestContent.validateDependencies(this.requests)) {\n\t\t\tconst error = new Error(`Invalid dependency found, Dependency should be:\n1. Parallel - no individual request states a dependency in the dependsOn property.\n2. Serial - all individual requests depend on the previous individual request.\n3. Same - all individual requests that state a dependency in the dependsOn property, state the same dependency.`);\n\t\t\terror.name = \"Invalid Dependency\";\n\t\t\tthrow error;\n\t\t}\n\t\twhile (!cur.done) {\n\t\t\tconst requestStep: BatchRequestStep = cur.value[1];\n\t\t\tconst batchRequestData: BatchRequestData = (await BatchRequestContent.getRequestData(requestStep.request as IsomorphicRequest)) as BatchRequestData;\n\t\t\t/**\n\t\t\t * @see{@https://tools.ietf.org/html/rfc7578#section-4.4}\n\t\t\t * TODO- Setting/Defaulting of content-type header to the correct value\n\t\t\t * @see {@link https://developer.microsoft.com/en-us/graph/docs/concepts/json_batching#request-format}\n\t\t\t */\n\t\t\tif (batchRequestData.body !== undefined && (batchRequestData.headers === undefined || batchRequestData.headers[\"content-type\"] === undefined)) {\n\t\t\t\tconst error = new Error(`Content-type header is not mentioned for request #${requestStep.id}, For request having body, Content-type header should be mentioned`);\n\t\t\t\terror.name = \"Invalid Content-type header\";\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t\tbatchRequestData.id = requestStep.id;\n\t\t\tif (requestStep.dependsOn !== undefined && requestStep.dependsOn.length > 0) {\n\t\t\t\tbatchRequestData.dependsOn = requestStep.dependsOn;\n\t\t\t}\n\t\t\trequests.push(batchRequestData);\n\t\t\tcur = iterator.next();\n\t\t}\n\t\trequestBody.requests = requests;\n\t\treturn requestBody;\n\t}\n\n\t/**\n\t * @public\n\t * Adds a dependency for a given dependent request\n\t * @param {string} dependentId - The id of the dependent request\n\t * @param {string} [dependencyId] - The id of the dependency request, if not specified the preceding request will be considered as a dependency\n\t * @returns Nothing\n\t */\n\tpublic addDependency(dependentId: string, dependencyId?: string): void {\n\t\tif (!this.requests.has(dependentId)) {\n\t\t\tconst error = new Error(`Dependent ${dependentId} does not exists, Please check the id`);\n\t\t\terror.name = \"Invalid Dependent\";\n\t\t\tthrow error;\n\t\t}\n\t\tif (typeof dependencyId !== \"undefined\" && !this.requests.has(dependencyId)) {\n\t\t\tconst error = new Error(`Dependency ${dependencyId} does not exists, Please check the id`);\n\t\t\terror.name = \"Invalid Dependency\";\n\t\t\tthrow error;\n\t\t}\n\t\tif (typeof dependencyId !== \"undefined\") {\n\t\t\tconst dependent = this.requests.get(dependentId);\n\t\t\tif (dependent.dependsOn === undefined) {\n\t\t\t\tdependent.dependsOn = [];\n\t\t\t}\n\t\t\tif (dependent.dependsOn.indexOf(dependencyId) !== -1) {\n\t\t\t\tconst error = new Error(`Dependency ${dependencyId} is already added for the request ${dependentId}`);\n\t\t\t\terror.name = \"Duplicate Dependency\";\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t\tdependent.dependsOn.push(dependencyId);\n\t\t} else {\n\t\t\tconst iterator = this.requests.entries();\n\t\t\tlet prev;\n\t\t\tlet cur = iterator.next();\n\t\t\twhile (!cur.done && cur.value[1].id !== dependentId) {\n\t\t\t\tprev = cur;\n\t\t\t\tcur = iterator.next();\n\t\t\t}\n\t\t\tif (typeof prev !== \"undefined\") {\n\t\t\t\tconst dId = prev.value[0];\n\t\t\t\tif (cur.value[1].dependsOn === undefined) {\n\t\t\t\t\tcur.value[1].dependsOn = [];\n\t\t\t\t}\n\t\t\t\tif (cur.value[1].dependsOn.indexOf(dId) !== -1) {\n\t\t\t\t\tconst error = new Error(`Dependency ${dId} is already added for the request ${dependentId}`);\n\t\t\t\t\terror.name = \"Duplicate Dependency\";\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t\tcur.value[1].dependsOn.push(dId);\n\t\t\t} else {\n\t\t\t\tconst error = new Error(`Can't add dependency ${dependencyId}, There is only a dependent request in the batch`);\n\t\t\t\terror.name = \"Invalid Dependency Addition\";\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @public\n\t * Removes a dependency for a given dependent request id\n\t * @param {string} dependentId - The id of the dependent request\n\t * @param {string} [dependencyId] - The id of the dependency request, if not specified will remove all the dependencies of that request\n\t * @returns The boolean indicating removed status\n\t */\n\tpublic removeDependency(dependentId: string, dependencyId?: string): boolean {\n\t\tconst request = this.requests.get(dependentId);\n\t\tif (typeof request === \"undefined\" || request.dependsOn === undefined || request.dependsOn.length === 0) {\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof dependencyId !== \"undefined\") {\n\t\t\tconst index = request.dependsOn.indexOf(dependencyId);\n\t\t\tif (index === -1) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\trequest.dependsOn.splice(index, 1);\n\t\t\treturn true;\n\t\t} else {\n\t\t\tdelete request.dependsOn;\n\t\t\treturn true;\n\t\t}\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}