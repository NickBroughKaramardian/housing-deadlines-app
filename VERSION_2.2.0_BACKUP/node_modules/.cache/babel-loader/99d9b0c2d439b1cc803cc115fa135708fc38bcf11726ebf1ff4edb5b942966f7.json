{"ast":null,"code":"// Microsoft 365 Authentication - Replaces Firebase Auth\nimport React from'react';import{authService,getDepartmentFromResponsibleParty,ROLES,DEPARTMENTS,DEPARTMENT_NAMES,hasPermission,getUsersByDepartment,isUserInDepartment,updateUserDepartments,inviteUser}from'./microsoftAuthService';// Auth Context\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/React.createContext();// Auth Provider Component\nexport function AuthProvider(_ref){let{children}=_ref;const[user,setUser]=React.useState(null);const[userProfile,setUserProfile]=React.useState(null);const[loading,setLoading]=React.useState(true);// Check for existing authentication on mount\nReact.useEffect(()=>{const checkAuth=async()=>{try{console.log('AuthProvider: Checking for existing authentication...');const result=await authService.getCurrentUser();if(result){console.log('AuthProvider: Found existing user:',result);setUser(result);setUserProfile(result);}else{console.log('AuthProvider: No existing user found');}}catch(error){console.log('AuthProvider: Error checking auth:',error);}finally{setLoading(false);}};checkAuth();},[]);const signIn=async()=>{try{console.log('Auth.js: Starting Microsoft sign in...');setLoading(true);const result=await authService.signIn();console.log('Auth.js: Sign in result:',result);if(result){// Update state with the signed-in user\nsetUser(result);setUserProfile(result);console.log('Auth.js: User state updated');}setLoading(false);return result;}catch(error){console.error('Auth.js: Sign in error:',error);setLoading(false);alert('Sign in failed: '+error.message);throw error;}};const signOut=async()=>{try{console.log('Auth.js: Starting sign out...');setLoading(true);await authService.signOut();setUser(null);setUserProfile(null);setLoading(false);console.log('Auth.js: Sign out successful');}catch(error){console.error('Auth.js: Sign out error:',error);setLoading(false);throw error;}};const getToken=async()=>{return await authService.getToken();};const value={user,userProfile,loading,signIn,signOut,getToken,hasPermission,ROLES,DEPARTMENTS,DEPARTMENT_NAMES,getUsersByDepartment,isUserInDepartment,updateUserDepartments,inviteUser};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});}// Auth Hook\nexport function useAuth(){const context=React.useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;}// Auth Gate Component\nexport function AuthGate(_ref2){let{children}=_ref2;const{userProfile,loading,signIn}=useAuth();if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-300\",children:\"Loading...\"})]})});}if(!userProfile){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 max-w-md w-full mx-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mx-auto h-16 w-16 bg-blue-600 rounded-full flex items-center justify-center mb-4\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"h-8 w-8 text-white\",fill:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M11.4 24H0V12.6h11.4V24zM24 24H12.6V12.6H24V24zM11.4 11.4H0V0h11.4v11.4zM24 11.4H12.6V0H24v11.4z\"})})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 dark:text-white mb-2\",children:\"C&C Project Manager\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-300 mb-6\",children:\"Sign in with your Microsoft 365 account to access the application\"})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{console.log('Sign in button clicked');signIn().catch(error=>{console.error('Sign in failed:',error);});},className:\"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center space-x-2\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"h-5 w-5\",fill:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M11.4 24H0V12.6h11.4V24zM24 24H12.6V12.6H24V24zM11.4 11.4H0V0h11.4v11.4zM24 11.4H12.6V0H24v11.4z\"})}),/*#__PURE__*/_jsx(\"span\",{children:\"Sign in with Microsoft\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 text-sm text-gray-500 dark:text-gray-400\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Test Environment\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-mono text-xs mt-1\",children:\"NickK@CCDAPSTEST.onmicrosoft.com\"})]})]})})});}return children;}// Export additional functions for compatibility\nexport{getDepartmentFromResponsibleParty,ROLES,DEPARTMENTS,DEPARTMENT_NAMES,hasPermission,getUsersByDepartment,isUserInDepartment,updateUserDepartments,inviteUser};export{authService as default};","map":{"version":3,"names":["React","authService","getDepartmentFromResponsibleParty","ROLES","DEPARTMENTS","DEPARTMENT_NAMES","hasPermission","getUsersByDepartment","isUserInDepartment","updateUserDepartments","inviteUser","jsx","_jsx","jsxs","_jsxs","AuthContext","createContext","AuthProvider","_ref","children","user","setUser","useState","userProfile","setUserProfile","loading","setLoading","useEffect","checkAuth","console","log","result","getCurrentUser","error","signIn","alert","message","signOut","getToken","value","Provider","useAuth","context","useContext","Error","AuthGate","_ref2","className","fill","viewBox","d","onClick","catch","default"],"sources":["/Users/nic/housing-deadlines-app/VERSION_2.2.0_BACKUP/src/Auth.js"],"sourcesContent":["// Microsoft 365 Authentication - Replaces Firebase Auth\nimport React from 'react';\nimport { authService, getDepartmentFromResponsibleParty, ROLES, DEPARTMENTS, DEPARTMENT_NAMES, hasPermission, getUsersByDepartment, isUserInDepartment, updateUserDepartments, inviteUser } from './microsoftAuthService';\n\n// Auth Context\nconst AuthContext = React.createContext();\n\n// Auth Provider Component\nexport function AuthProvider({ children }) {\n  const [user, setUser] = React.useState(null);\n  const [userProfile, setUserProfile] = React.useState(null);\n  const [loading, setLoading] = React.useState(true);\n\n  // Check for existing authentication on mount\n  React.useEffect(() => {\n    const checkAuth = async () => {\n      try {\n        console.log('AuthProvider: Checking for existing authentication...');\n        const result = await authService.getCurrentUser();\n        if (result) {\n          console.log('AuthProvider: Found existing user:', result);\n          setUser(result);\n          setUserProfile(result);\n        } else {\n          console.log('AuthProvider: No existing user found');\n        }\n      } catch (error) {\n        console.log('AuthProvider: Error checking auth:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    checkAuth();\n  }, []);\n\n  const signIn = async () => {\n    try {\n      console.log('Auth.js: Starting Microsoft sign in...');\n      setLoading(true);\n      \n      const result = await authService.signIn();\n      console.log('Auth.js: Sign in result:', result);\n      \n      if (result) {\n        // Update state with the signed-in user\n        setUser(result);\n        setUserProfile(result);\n        console.log('Auth.js: User state updated');\n      }\n      \n      setLoading(false);\n      return result;\n    } catch (error) {\n      console.error('Auth.js: Sign in error:', error);\n      setLoading(false);\n      alert('Sign in failed: ' + error.message);\n      throw error;\n    }\n  };\n\n  const signOut = async () => {\n    try {\n      console.log('Auth.js: Starting sign out...');\n      setLoading(true);\n      await authService.signOut();\n      setUser(null);\n      setUserProfile(null);\n      setLoading(false);\n      console.log('Auth.js: Sign out successful');\n    } catch (error) {\n      console.error('Auth.js: Sign out error:', error);\n      setLoading(false);\n      throw error;\n    }\n  };\n\n  const getToken = async () => {\n    return await authService.getToken();\n  };\n\n  const value = {\n    user,\n    userProfile,\n    loading,\n    signIn,\n    signOut,\n    getToken,\n    hasPermission,\n    ROLES,\n    DEPARTMENTS,\n    DEPARTMENT_NAMES,\n    getUsersByDepartment,\n    isUserInDepartment,\n    updateUserDepartments,\n    inviteUser\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\n// Auth Hook\nexport function useAuth() {\n  const context = React.useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n\n// Auth Gate Component\nexport function AuthGate({ children }) {\n  const { userProfile, loading, signIn } = useAuth();\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n          <p className=\"text-gray-600 dark:text-gray-300\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!userProfile) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center\">\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 max-w-md w-full mx-4\">\n          <div className=\"text-center\">\n            <div className=\"mb-6\">\n              <div className=\"mx-auto h-16 w-16 bg-blue-600 rounded-full flex items-center justify-center mb-4\">\n                <svg className=\"h-8 w-8 text-white\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path d=\"M11.4 24H0V12.6h11.4V24zM24 24H12.6V12.6H24V24zM11.4 11.4H0V0h11.4v11.4zM24 11.4H12.6V0H24v11.4z\"/>\n                </svg>\n              </div>\n              <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\n                C&C Project Manager\n              </h1>\n              <p className=\"text-gray-600 dark:text-gray-300 mb-6\">\n                Sign in with your Microsoft 365 account to access the application\n              </p>\n            </div>\n            \n            <button\n              onClick={() => {\n                console.log('Sign in button clicked');\n                signIn().catch(error => {\n                  console.error('Sign in failed:', error);\n                });\n              }}\n              className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center space-x-2\"\n            >\n              <svg className=\"h-5 w-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path d=\"M11.4 24H0V12.6h11.4V24zM24 24H12.6V12.6H24V24zM11.4 11.4H0V0h11.4v11.4zM24 11.4H12.6V0H24v11.4z\"/>\n              </svg>\n              <span>Sign in with Microsoft</span>\n            </button>\n            \n            <div className=\"mt-6 text-sm text-gray-500 dark:text-gray-400\">\n              <p>Test Environment</p>\n              <p className=\"font-mono text-xs mt-1\">NickK@CCDAPSTEST.onmicrosoft.com</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return children;\n}\n\n// Export additional functions for compatibility\nexport { \n  getDepartmentFromResponsibleParty, \n  ROLES, \n  DEPARTMENTS, \n  DEPARTMENT_NAMES, \n  hasPermission, \n  getUsersByDepartment, \n  isUserInDepartment, \n  updateUserDepartments, \n  inviteUser \n};\n\nexport { authService as default };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}